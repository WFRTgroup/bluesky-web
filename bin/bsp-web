#! /usr/bin/env python

__author__ = "Joel Dubowy"
__copyright__ = "Copyright 2015, AirFire, PNW, USFS"

import tornado.ioloop

from pyairfire import scripting

try:
    from bluesky.web.app import main
except:
    import os
    import sys
    root_dir = os.path.abspath(os.path.join(sys.path[0], '../'))
    sys.path.insert(0, root_dir)
    from bluesky.web.app import main

OPTIONAL_ARGS = [
    {
        'short': '-p',
        'long': '--port',
        'dest': 'port',
        'help': 'run the server listening on speciied port',
        'action': "store",
        'default': 8888
    },
    {
        'short': '-d',
        'long': '--debug',
        'dest': 'debug',
        'help': 'run the server in debug mode (with auto-reloading of code, etc.)',
        'action': "store_true",
        'default': False
    },

]

if __name__ == "__main__":
    parser = scripting.args.ArgumentParser()
    scripting.args.add_arguments(parser, OPTIONAL_ARGS)
    # Use pyairfire to add logging options to the parser object, but we'll
    # configure logging oureselves in app.main
    scripting.args.add_logging_options(parser)
    args = parser.parse_args()
    main(args.port, log_level_str=args.log_level, log_file=args.log_file,
        log_format=args.log_message_format, debug=args.debug)
