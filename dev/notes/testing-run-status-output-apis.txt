# Testing run status and output APIs using existing exported outputs

## setup

Using the following runs, each in http://www.blueskywebhost.com/bluesky-web-output/,
 - Success: $RUN_ID_1
 - Non-existent: foobar1
 - Failed: $RUN_ID_2

First, grab input

    mkdir -p /bsp-output/from-production/
    mkdir /bsp-output/from-production/$RUN_ID_1/
    mkdir /bsp-output/from-production/$RUN_ID_2

    cd /bsp-output/from-production/$RUN_ID_1/ && wget http://www.blueskywebhost.com/bluesky-web-output/$RUN_ID_1/output.json
    cd /bsp-output/from-production/$RUN_ID_2 && wget http://www.blueskywebhost.com/bluesky-web-output/$RUN_ID_2/output.json

## start server

### Upload

    BSPWEB_EXPORT_MODE=upload \
        BSPWEB_EXPORT_UPLOAD_SCP_USER=jdubowy \
        BSPWEB_EXPORT_UPLOAD_SCP_PROTOCOL=https \
        BSPWEB_EXPORT_UPLOAD_SCP_HOST=www.blueskywebhost.com \
        ./bin/bsp-web -d --log-level=DEBUG

### localsave

    BSPWEB_EXPORT_MODE=localsave \
        BSPWEB_EXPORT_LOCALSAVE_DEST_DIR=/bsp-output/from-production/ \
        ./bin/bsp-web -d --log-level=DEBUG

### upload where upload server is the same as request server

this is really conrived, since he upload scp host wouldn't eveb localhost

    BSPWEB_EXPORT_MODE=upload \
        BSPWEB_EXPORT_UPLOAD_SCP_DEST_DIR=/bsp-output/from-production/ \
        BSPWEB_EXPORT_UPLOAD_SCP_USER=jdubowy \
        BSPWEB_EXPORT_UPLOAD_SCP_PROTOCOL=http \
        BSPWEB_EXPORT_UPLOAD_SCP_HOST=localhost \
        ./bin/bsp-web -d --log-level=DEBUG

## test

### status

v1:

    curl -D - http://localhost:8887/api/v1/run/$RUN_ID_1/status  # success
    curl -D - http://localhost:8887/api/v1/run/foobar1/status  # non-existent
    curl -D - http://localhost:8887/api/v1/run/$RUN_ID_2/status  # failed

v4.1:

    curl -D - http://localhost:8887/api/v4.1/run/$RUN_ID_1/status  # success
    curl -D - http://localhost:8887/api/v4.1/run/foobar1/status  # non-existent
    curl -D - http://localhost:8887/api/v4.1/run/$RUN_ID_2/status  # failed

### output:

v1:

    curl -D - http://localhost:8887/api/v1/run/$RUN_ID_1/output  # success
    curl -D - http://localhost:8887/api/v1/run/foobar1/output  # non-existent
    curl -D - http://localhost:8887/api/v1/run/$RUN_ID_2/output  # failed

v4.1:

    curl -D - http://localhost:8887/api/v4.1/run/$RUN_ID_1/output  # success
    curl -D - http://localhost:8887/api/v4.1/run/foobar1/output  # non-existent
    curl -D - http://localhost:8887/api/v4.1/run/$RUN_ID_2/output  # failed

## Testing end to end

make sure scheduler system is working with bsp workers

post requests

    ...
